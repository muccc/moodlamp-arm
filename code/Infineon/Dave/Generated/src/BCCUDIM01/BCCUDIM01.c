/*******************************************************************************
**  DAVE App Name : BCCUDIM01       App Version: 1.0.5               
**  This file is generated by DAVE, User modification to this file will be    **
**  overwritten at the next code generation.                                  **
*******************************************************************************/

/*CODE_BLOCK_BEGIN[BCCUDIM01.c]*/
/****************************************************************************
 * @file     BCCUDIM01.c
 * @brief    Configuration header file generated based on UI settings 
 *           of BCCUDIM01 App. It contains all Dimming Engine related drivers.
 * @version  V1.0.6
 * @date     12-Nov-13
 *
 * @note
 * Copyright (C) 2012-2013 Infineon Technologies AG. All rights reserved.

 *
 * @par
 * Infineon Technologies AG (Infineon) is supplying this software for use with
 * Infineon's microcontrollers.
 *
 * This file can be freely distributed within development tools that are
 * supporting such microcontrollers.
 *
 *
 * @par
 * THIS SOFTWARE IS PROVIDED "AS IS".  NO WARRANTIES, WHETHER EXPRESS, IMPLIED
 * OR STATUTORY, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE APPLY TO THIS SOFTWARE.
 * INFINEON SHALL NOT, IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL,
 * OR CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
 *
 ******************************************************************************/
/**************************** Change history ***********************************
 * V1.0.0,	14-Feb-13	 Initial Version
 * V1.0.2,	3-Apr-13	 Initial Target dimming level immediately upon 
 *                       initialization and then update the desired transition 
 *                       time (specified in GUI) is fixed.
 * V1.0.4   4-Oct-13     C++ Support extended and Updated with new Device IDs. 
 * V1.0.6   12-Nov-13     MISRA Checks done, Multiple inclusion of DAVE3.h 
 *                       removed, Extern.h added
 * *************************** Change history *********************************/

 
 
/*******************************************************************************
 ** INCLUDE FILES                                                             **
 ******************************************************************************/

/** Inclusion of header file */
#include "../../inc/BCCUDIM01/BCCUDIM01.h"

/*******************************************************************************
**                      Private Macro Definitions                             **
*******************************************************************************/


/*******************************************************************************
**                      Private Type Definitions                              **
*******************************************************************************/


/*******************************************************************************
**                 Private Function Declarations                              **
*******************************************************************************/

void BCCUDIM01_lGUIInit(const BCCUDIM01_HandleType * handle);
/*******************************************************************************
**                      Global Constant Definitions                           **
*******************************************************************************/

/*******************************************************************************
**                      Global Variable Definitions                           **
*******************************************************************************/

/*******************************************************************************
**                      Private Constant Definitions                          **
*******************************************************************************/

/*******************************************************************************
**                 Function like macro definitions                            **
*******************************************************************************/
/*#define GET_CHANNEL_DIM_MASK(x) (1UL << x)  This is moved to BCCUGLOBAL.h*/
/*******************************************************************************
**                      Private Function Definitions                          **
*******************************************************************************/

 void BCCUDIM01_lGUIInit(const BCCUDIM01_HandleType * handle)
{
	BCCU_DE_Type * DeRegs = handle->BCCU_DE_Regs;

	BCCU_Type* BCCURegs = handle->BCCURegs;

	/* Select the DimDiv value, Dither function 
                selection and Curve selection */
	DeRegs->DTT |= (
              ((uint32_t)(handle->DitherEnable) << BCCU_DE_DTT_DTEN_Pos) |
		((uint32_t)(handle->CurveSel) << BCCU_DE_DTT_CSEL_Pos)
        );

    /* Enable the Dimming Engine */
    if (ENGINE_EN == handle->EnableAtStart)
    {
      BCCURegs->DEEN |= GET_CHANNEL_DIM_MASK(handle->DE_Num);
    }

    /* Initial Dimming Level */
    DeRegs->DLS |= handle->InitialLevel;

    /* Enable the Shadow Transfer with Initial Dimming Level  */
    BCCURegs->DESTRCON |= GET_CHANNEL_DIM_MASK(handle->DE_Num);

    /* Configures DIMDIV */
    DeRegs->DTT |= (((uint32_t)(handle->DimDiv) << BCCU_DE_DTT_DIMDIV_Pos));

  }

/*******************************************************************************
**                      Public Function Definitions                           **
*******************************************************************************/
void BCCUDIM01_Init(void)
{
    uint32_t num;
    for (num = 0; num < BCCUDIM01_NUM_INSTANCES; num++)
    {
        BCCUDIM01_lGUIInit(BCCUDIM01_HandleArr[num]);  
    }        
     
}

inline void BCCUDIM01_Enable(const BCCUDIM01_HandleType * handle,
    uint32_t EngineMask)
{
	handle->BCCURegs->DEEN |= EngineMask;
}


inline void BCCUDIM01_Disable(const BCCUDIM01_HandleType * handle,
    uint32_t EngineMask)
{
    handle->BCCURegs->DEEN &= ~EngineMask;
}
inline void BCCUDIM01_StartDimming(const BCCUDIM01_HandleType * handle,
    uint32_t EngineMask)
{
    handle->BCCURegs->DESTRCON |= EngineMask;
}

inline void BCCUDIM01_AbortDimming(const BCCUDIM01_HandleType * handle,
    uint32_t EngineMask)
{
    handle->BCCURegs->DESTRCON |= (EngineMask << BCCU_DESTRCON_DE0A_Pos);
}

inline void BCCUDIM01_SetDimLvl(const BCCUDIM01_HandleType * handle,
    uint32_t DimLevel)
{
    WR_REG(handle->BCCU_DE_Regs->DLS, BCCU_DE_DLS_TDLEV_Msk,
        BCCU_DE_DLS_TDLEV_Pos, DimLevel);
}

inline uint32_t BCCUDIM01_GetDimLvl(const BCCUDIM01_HandleType * handle)
{
    return ((uint32_t)(handle->BCCU_DE_Regs->DL) & BCCU_DE_DL_DLEV_Msk);
}

inline uint32_t BCCUDIM01_GetDimCurve(const BCCUDIM01_HandleType * handle)
{
	return ((handle->BCCU_DE_Regs->DTT & BCCU_DE_DTT_CSEL_Msk)
        >> BCCU_DE_DTT_CSEL_Pos);	
}

inline void BCCUDIM01_SetDimCurve(const BCCUDIM01_HandleType * handle,
    uint32_t Curve)
{
    WR_REG(handle->BCCU_DE_Regs->DTT, BCCU_DE_DTT_CSEL_Msk, BCCU_DE_DTT_CSEL_Pos,
        Curve);
}

inline void BCCUDIM01_DitherEnable(const BCCUDIM01_HandleType * handle)
{
    handle->BCCU_DE_Regs->DTT |= BCCU_DE_DTT_DTEN_Msk;
}

inline void BCCUDIM01_DitherDisable(const BCCUDIM01_HandleType * handle)
{
    handle->BCCU_DE_Regs->DTT &= ~BCCU_DE_DTT_DTEN_Msk;
}


inline uint32_t BCCUDIM01_FadeCompletionStatus(const BCCUDIM01_HandleType * handle)
{
    return ((handle->BCCURegs->DESTRCON & GET_CHANNEL_DIM_MASK(handle->DE_Num))
        >> handle->DE_Num);
}

inline void BCCUDIM01_AwaitFadeCompletion(const BCCUDIM01_HandleType * handle)
{
  /* Poll until the fading has completed */
  while (BCCUDIM01_FadeCompletionStatus(handle) == 1);
}

inline void BCCUDIM01_SetDimDiv(const BCCUDIM01_HandleType * handle, uint32_t DimDiv)
{
    WR_REG(handle->BCCU_DE_Regs->DTT, BCCU_DE_DTT_DIMDIV_Msk,
        BCCU_DE_DTT_DIMDIV_Pos, DimDiv);
}

inline uint32_t BCCUDIM01_GetDimDiv(const BCCUDIM01_HandleType * handle)
{
    return ((uint32_t)(handle->BCCU_DE_Regs->DTT) & BCCU_DE_DTT_DIMDIV_Msk);
}

/**
  * @}
  */
 /*CODE_BLOCK_END*/

